<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Webcam Stream</title>
    <style>
        #videoElement {
            width: 100%;
            background-color: #666;
        }
    </style>
</head>
<body>
    <div id="container">
        <button id="micToggleButton">Start Mic</button>
    <audio id="audioOutput" autoplay></audio>
    <video autoplay="true" id="videoElement"></video>
    </div>
    <script>const video = document.getElementById('videoElement');

if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(function (stream) {
            video.srcObject = stream;
        })
        .catch(function (error) {
            console.error('Error accessing webcam:', error);
        });
} else {
    console.error('getUserMedia is not supported in this browser.');
}

</script>

<script>
        let currentStream = null; // Stores the active MediaStream from the microphone
        const micToggleButton = document.getElementById('micToggleButton');
        const audioOutput = document.getElementById('audioOutput');

        // Add an event listener to the button for click events
        micToggleButton.addEventListener('click', async () => {
            if (currentStream) {
                // If there's an active stream, stop all its tracks
                currentStream.getAudioTracks().forEach(track => track.stop());
                currentStream = null; // Clear the stream reference
                audioOutput.srcObject = null; // Disconnect the audio output
                micToggleButton.textContent = 'Start Mic'; // Change button text
                console.log('Microphone stopped.');
            } else {
                // If no active stream, request microphone access and start streaming
                try {
                    // Request access to the user's audio input (microphone)
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
                    currentStream = stream; // Store the new stream
                    audioOutput.srcObject = stream; // Direct the live stream to the audio element
                    micToggleButton.textContent = 'Stop Mic'; // Change button text
                    console.log('Microphone started, streaming to speakers.');

                    // Optional: Listen for when the stream becomes inactive (e.g., device disconnected)
                    stream.oninactive = () => {
                        console.log('Microphone stream became inactive unexpectedly.');
                        // Clean up if the stream stops without explicit user action
                        if (currentStream) {
                            currentStream.getAudioTracks().forEach(track => track.stop());
                            currentStream = null;
                            audioOutput.srcObject = null;
                            micToggleButton.textContent = 'Start Mic';
                        }
                    };

                } catch (err) {
                    // Handle errors if microphone access is denied or fails
                    console.error('Error accessing microphone:', err);
                    alert('Could not access microphone: ' + err.message + '\nPlease ensure microphone access is allowed.');
                    micToggleButton.textContent = 'Start Mic'; // Reset button text on error
                }
            }
        });
    </script>
</body>
</html>
